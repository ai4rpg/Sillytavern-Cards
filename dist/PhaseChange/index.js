$(()=>{const t='stat_data.user.current_phase[0]',e='stat_data.user.action_points[0]',a='stat_data.user.sex_statue.body_excitement[0]',s='stat_data.user.sex_statue.spiritual_desire[0]',n='stat_data.user.special_abilities[0]',o='stat_data.user.profile.bless_old_gods[0]',r='stat_data.user.profile.solved_cases_count[0]',l='stat_data.world.current_case.case_name[0]',i='stat_data.world.current_case.case_location[0]',d='stat_data.world.current_case.difficulty_class[0]',c='stat_data.world.current_case.out_of_control[0]',u='stat_data.latent_variables.ejs_index.phase_changed[0]',f='stat_data.latent_variables.ejs_index.experience[0]',g='stat_data.latent_variables.ability_update.candidate_ability_qualities[0]';function p(a,s){const p=_.get(a,d),h=_.get(a,f);!function(a){const s=_.get(a,t);let n=_.get(a,e);const o=_.get(a,c),r={日常阶段:()=>n<=0?2:-1,侦破阶段:()=>o<=0?3:n<=0?4:-1};'日常阶段'===s&&(n-=1);let l=_.get(a,u);if(0===l)l=1;else if(-1===l){const t=r[s];t&&(l=t())}else 1===l||2===l?l=-1:l>=3&&(l=1);_.set(a,u,l),_.set(a,e,n)}(a);const y=_.get(a,u);if(1===y)!function(t){const e=_.get(t,n,[]);let a=0;e.forEach(t=>{t&&!1===_.get(t,'is_passive[0]')&&!0===_.get(t,'is_used[0]')&&(_.set(t,'is_used[0]',!1),a++)}),a>0&&console.log(`已成功重置 ${a} 个主动技能的使用状态。`)}(a),function(t,a){_.set(t,l,''),_.set(t,i,''),_.set(t,d,0),_.set(t,e,a),_.set(t,c,0)}(a,s),function(t,e=0){const a=_.get(t,o),s={Bast:0,Hypnos:0,Nodens:0},n={猫的庇护:{...s,Bast:5},面庞的庇护:{...s,Hypnos:5},隐者的庇护:{...s,Nodens:5}},r=a&&n[a]||s,l=[...Array(27).fill('普通'),...Array(9).fill('稀有'),...Array(3).fill('史诗'),'传说'];_.update(t,g,t=>_.mapValues(t[0],t=>{const a=l.length-1,s=Math.min(e+(r[t]||0),a);return l[_.random(s,a)]})),console.log('已根据经验值和旧神的庇护抽选候选能力品质, 等待AI响应。')}(a,h),_.set(a,t,'日常阶段');else if(2===y){_.set(a,t,'侦破阶段');!function(t,a){const s=Math.max(1,Math.floor((5*Math.random()+a+2)/3));_.set(t,d,s),_.set(t,e,5*s+5),_.set(t,c,50)}(a,(t=>{for(let e=0;e<5;e++)if((t-=3*e)<=0)return e;return 5})(h))}else y>=3&&(_.update(a,f,t=>t+3*p),_.update(a,r,t=>t+4-y),_.update(a,f,t=>t+p*(9-2*y)),_.set(a,t,'后日谈阶段'),_.set(a,e,1))}function h(t){return t>=0?t:0}eventOn('mag_variable_update_ended',async t=>{try{const o=getLastMessageId(),r=getChatMessages(o);if(!r||0===r.length)return void console.error('无法加载最新楼层消息。');if('user'===r[0].role){p(t,o<=1?3:5),console.log('后台状态更新已成功应用。')}n=t,_.update(n,e,h),_.update(n,a,h),_.update(n,s,h),_.update(n,c,h)}catch(t){console.error('脚本错误:',t)}var n}),console.log('世界状态后台自动化脚本已加载并监听 \'mag_variable_update_ended\' 事件。')});
//# sourceMappingURL=index.js.map