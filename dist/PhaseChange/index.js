$(()=>{const t='stat_data.user.current_phase[0]',e='stat_data.user.action_points[0]',a='stat_data.user.special_abilities[0]',s='stat_data.user.profile.bless_old_gods[0]',n='stat_data.user.profile.solved_cases_count[0]',o='stat_data.world.current_case.case_name[0]',r='stat_data.world.current_case.case_location[0]',l='stat_data.world.current_case.difficulty_class[0]',c='stat_data.world.current_case.out_of_control[0]',i='stat_data.latent_variables.ejs_index.phase_changed[0]',d='stat_data.latent_variables.ejs_index.experience[0]',u='stat_data.latent_variables.ability_update.candidate_ability_qualities[0]';function g(g){const f=_.get(g,l),p=_.get(g,d);!function(a){const s=_.get(a,t);let n=_.get(a,e);const o=_.get(a,c),r={日常阶段:()=>n<=0?2:-1,侦破阶段:()=>o<=0?3:n<=0?4:-1};'日常阶段'===s&&(n-=1);let l=_.get(a,i);if(0===l)l=1;else if(-1===l){const t=r[s];t&&(l=t())}else 1===l||2===l?l=-1:l>=3&&(l=1);_.set(a,i,l)}(g);const h=_.get(g,i);if(1===h)!function(t){const e=_.get(t,a,[]);let s=0;e.forEach(t=>{t&&!1===_.get(t,'is_passive[0]')&&!0===_.get(t,'is_used[0]')&&(_.set(t,'is_used[0]',!1),s++)}),s>0&&console.log(`已成功重置 ${s} 个主动技能的使用状态。`)}(g),function(t){_.set(t,o,''),_.set(t,r,''),_.set(t,l,0),_.set(t,e,5),_.set(t,c,0)}(g),function(t,e=0){const a=_.get(t,s),n={Bast:0,Hypnos:0,Nodens:0},o={猫的庇护:{...n,Bast:5},面庞的庇护:{...n,Hypnos:5},隐者的庇护:{...n,Nodens:5}},r=a&&o[a]||n,l=[...Array(27).fill('普通'),...Array(9).fill('稀有'),...Array(3).fill('史诗'),'传说'];_.update(t,u,t=>_.mapValues(t,t=>{const a=l.length-1,s=Math.min(e+(r[t]||0),a);return l[_.random(s,a)]})),console.log('已根据经验值和旧神的庇护抽选候选能力品质, 等待AI响应。')}(g,p),_.set(g,t,'日常阶段');else if(2===h){_.set(g,t,'侦破阶段');!function(t,a){const s=Math.max(1,Math.floor((5*Math.random()+a+2)/3));_.set(t,l,s),_.set(t,e,5*s+5),_.set(t,c,50)}(g,(t=>{for(let e=0;e<5;e++)if((t-=3*e)<=0)return e;return 5})(p))}else h>=3&&(_.update(g,d,t=>t+3*f),_.update(g,n,t=>t+4-h),_.update(g,d,t=>t+f*(9-2*h)),_.set(g,t,'后日谈阶段'),_.set(g,e,1))}eventOn('mag_variable_update_ended',async t=>{try{const e=getLastMessageId(),a=getChatMessages(e);if(!a||0===a.length)return void console.error('无法加载最新楼层消息。');'user'===a[0].role&&(g(t),console.log('后台状态更新已成功应用。'))}catch(t){console.error('脚本错误:',t)}}),console.log('世界状态后台自动化脚本已加载并监听 \'mag_variable_update_ended\' 事件。')});
//# sourceMappingURL=index.js.map