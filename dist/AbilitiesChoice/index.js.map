{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/external var \"_\"","webpack://tavern_helper_template/./src/AbilitiesChoice/app.vue?4ab9","webpack://tavern_helper_template/src/AbilitiesChoice/app.vue?b3b2","src://tavern_helper_template/src/AbilitiesChoice/actions.ts","src://tavern_helper_template/src/AbilitiesChoice/index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","const __WEBPACK_NAMESPACE_OBJECT__ = _;","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, normalizeStyle as _normalizeStyle, normalizeClass as _normalizeClass, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"skill-card-header\" };\nconst _hoisted_2 = { class: \"skill-title\" };\nconst _hoisted_3 = { class: \"skill-meta\" };\nconst _hoisted_4 = { class: \"skill-card-body\" };\nconst _hoisted_5 = { class: \"skill-card-header\" };\nconst _hoisted_6 = { class: \"skill-title\" };\nconst _hoisted_7 = { class: \"skill-meta\" };\nconst _hoisted_8 = { class: \"skill-card-body\" };\nconst _hoisted_9 = { class: \"skill-card-header\" };\nconst _hoisted_10 = { class: \"skill-title\" };\nconst _hoisted_11 = { class: \"skill-meta\" };\nconst _hoisted_12 = { class: \"skill-card-body\" };\nimport { onMounted, ref } from 'vue';\nimport { selectAbility } from './actions';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'app',\n    setup(__props) {\n        const isSelecting = ref(false);\n        const originalAbilities = ref([]);\n        const bast = ref({\n            ability_name: 'Loading...',\n            ability_quality: '',\n            ability_description: '',\n            is_passive: false,\n        });\n        const hypnos = ref({\n            ability_name: 'Loading...',\n            ability_quality: '',\n            ability_description: '',\n            is_passive: false,\n        });\n        const nodens = ref({\n            ability_name: 'Loading...',\n            ability_quality: '',\n            ability_description: '',\n            is_passive: false,\n        });\n        const handleSelect = async (index) => {\n            if (isSelecting.value)\n                return;\n            isSelecting.value = true;\n            await selectAbility(originalAbilities.value[index]);\n        };\n        function getQualityColor(quality) {\n            switch (quality) {\n                case '普通':\n                    return 'var(--text-dim)';\n                case '稀有':\n                    return 'var(--aq-green)';\n                case '史诗':\n                    return 'var(--aq-orange)';\n                case '传说':\n                    return 'var(--aq-gold)';\n                default:\n                    return 'var(--text-light)';\n            }\n        }\n        /**\n         * The AI returns ability properties as an array, where the first element is the value\n         * and the second is an explanation. This function extracts the value.\n         */\n        function parseAbility(abilityData) {\n            const parsed = {};\n            for (const key in abilityData) {\n                if (Object.prototype.hasOwnProperty.call(abilityData, key)) {\n                    if (Array.isArray(abilityData[key]) && abilityData[key].length > 0) {\n                        parsed[key] = abilityData[key][0];\n                    }\n                    else {\n                        parsed[key] = abilityData[key];\n                    }\n                }\n            }\n            return parsed;\n        }\n        onMounted(async () => {\n            try {\n                await waitGlobalInitialized('Mvu');\n                const mvuData = Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n                if (!mvuData || !mvuData.stat_data) {\n                    throw new Error('未在聊天变量中找到 stat_data。');\n                }\n                const generatedAbilities = mvuData?.stat_data?.latent_variables?.ability_update?.generated_abilities[0];\n                if (generatedAbilities && Array.isArray(generatedAbilities) && generatedAbilities.length === 3) {\n                    originalAbilities.value = generatedAbilities;\n                    bast.value = parseAbility(generatedAbilities[0]);\n                    hypnos.value = parseAbility(generatedAbilities[1]);\n                    nodens.value = parseAbility(generatedAbilities[2]);\n                }\n                else {\n                    throw new Error('未能够正确获取 AI 生成的候选能力');\n                }\n            }\n            catch (error) {\n                console.error('Failed to initialize AbilitiesChoice:', error);\n                bast.value.ability_name = 'Error';\n                bast.value.ability_description = String(error);\n                hypnos.value.ability_name = 'Error';\n                hypnos.value.ability_description = String(error);\n                nodens.value.ability_name = 'Error';\n                nodens.value.ability_description = String(error);\n            }\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(_Fragment, null, [\n                _cache[3] || (_cache[3] = _createElementVNode(\"div\", { class: \"hud-header\" }, [\n                    _createElementVNode(\"h2\", { class: \"hud-block-title\" }, \"[ 新的特殊能力 ]\"),\n                    _createElementVNode(\"div\", { class: \"hud-phase\" }, \"选择一个祝福\")\n                ], -1 /* CACHED */)),\n                _createElementVNode(\"div\", {\n                    class: _normalizeClass([\"skill-upgrade-grid\", { selecting: isSelecting.value }])\n                }, [\n                    _createElementVNode(\"div\", {\n                        class: \"skill-card\",\n                        id: \"bast\",\n                        onClick: _cache[0] || (_cache[0] = ($event) => (handleSelect(0)))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_1, [\n                            _createElementVNode(\"h3\", _hoisted_2, _toDisplayString(bast.value.ability_name), 1 /* TEXT */),\n                            _createElementVNode(\"div\", _hoisted_3, [\n                                _createElementVNode(\"span\", {\n                                    class: \"skill-quality\",\n                                    style: _normalizeStyle({ color: getQualityColor(bast.value.ability_quality) })\n                                }, _toDisplayString(bast.value.ability_quality), 5 /* TEXT, STYLE */),\n                                _createElementVNode(\"span\", {\n                                    class: \"skill-nature\",\n                                    style: _normalizeStyle({ color: bast.value.is_passive ? 'var(--detective-cyan)' : 'var(--erotic-pink)' })\n                                }, _toDisplayString(bast.value.is_passive ? '被动' : '主动'), 5 /* TEXT, STYLE */)\n                            ])\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_4, _toDisplayString(bast.value.ability_description), 1 /* TEXT */)\n                    ]),\n                    _createElementVNode(\"div\", {\n                        class: \"skill-card\",\n                        id: \"hypnos\",\n                        onClick: _cache[1] || (_cache[1] = ($event) => (handleSelect(1)))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_5, [\n                            _createElementVNode(\"h3\", _hoisted_6, _toDisplayString(hypnos.value.ability_name), 1 /* TEXT */),\n                            _createElementVNode(\"div\", _hoisted_7, [\n                                _createElementVNode(\"span\", {\n                                    class: \"skill-quality\",\n                                    style: _normalizeStyle({ color: getQualityColor(hypnos.value.ability_quality) })\n                                }, _toDisplayString(hypnos.value.ability_quality), 5 /* TEXT, STYLE */),\n                                _createElementVNode(\"span\", {\n                                    class: \"skill-nature\",\n                                    style: _normalizeStyle({ color: hypnos.value.is_passive ? 'var(--detective-cyan)' : 'var(--erotic-pink)' })\n                                }, _toDisplayString(hypnos.value.is_passive ? '被动' : '主动'), 5 /* TEXT, STYLE */)\n                            ])\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_8, _toDisplayString(hypnos.value.ability_description), 1 /* TEXT */)\n                    ]),\n                    _createElementVNode(\"div\", {\n                        class: \"skill-card\",\n                        id: \"nodens\",\n                        onClick: _cache[2] || (_cache[2] = ($event) => (handleSelect(2)))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_9, [\n                            _createElementVNode(\"h3\", _hoisted_10, _toDisplayString(nodens.value.ability_name), 1 /* TEXT */),\n                            _createElementVNode(\"div\", _hoisted_11, [\n                                _createElementVNode(\"span\", {\n                                    class: \"skill-quality\",\n                                    style: _normalizeStyle({ color: getQualityColor(nodens.value.ability_quality) })\n                                }, _toDisplayString(nodens.value.ability_quality), 5 /* TEXT, STYLE */),\n                                _createElementVNode(\"span\", {\n                                    class: \"skill-nature\",\n                                    style: _normalizeStyle({ color: nodens.value.is_passive ? 'var(--detective-cyan)' : 'var(--erotic-pink)' })\n                                }, _toDisplayString(nodens.value.is_passive ? '被动' : '主动'), 5 /* TEXT, STYLE */)\n                            ])\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_12, _toDisplayString(nodens.value.ability_description), 1 /* TEXT */)\n                    ])\n                ], 2 /* CLASS */)\n            ], 64 /* STABLE_FRAGMENT */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./app.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./app.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./app.vue?vue&type=style&index=0&id=3f3fd9f0&lang=scss\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { isEqual, merge } from 'lodash';\n\nexport async function selectAbility(ability: any) {\n  try {\n    await waitGlobalInitialized('Mvu');\n    const mvuData = Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n    if (!mvuData || !mvuData.stat_data) {\n      throw new Error('未在聊天变量中找到 stat_data。');\n    }\n\n    if (!isEqual(ability.is_used, [false, ''])) {\n      ability.is_used = [false, ''];\n    }\n\n    const command = `_.assign('user.special_abilities[0]', ${JSON.stringify(ability)}); // choose a special abilities`;\n    const newMvuData = await Mvu.parseMessage(command, mvuData);\n\n    if (newMvuData) {\n      if (mvuData.delta_data) {\n        newMvuData.delta_data = merge({}, mvuData.delta_data, newMvuData.delta_data);\n      }\n      await Mvu.replaceMvuData(newMvuData, { type: 'message', message_id: 'latest' });\n    }\n    toastr.success(`已选择能力: ${ability.ability_name}`);\n  } catch (error) {\n    console.error('Failed to select ability:', error);\n    toastr.error(`选择能力失败: ${String(error)}`);\n  }\n}\n","import { createApp } from 'vue';\nimport app from './app.vue';\n\n$(() => {\n  createApp(app).mount('#app');\n});\n"],"names":["Vue","_","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","__name","setup","__props","isSelecting","ref","originalAbilities","bast","ability_name","ability_quality","ability_description","is_passive","hypnos","nodens","handleSelect","async","index","value","ability","waitGlobalInitialized","mvuData","Mvu","getMvuData","type","message_id","stat_data","Error","isEqual","is_used","command","JSON","stringify","newMvuData","parseMessage","delta_data","merge","replaceMvuData","toastr","success","error","console","String","selectAbility","getQualityColor","quality","parseAbility","abilityData","parsed","key","Object","prototype","hasOwnProperty","call","Array","isArray","length","onMounted","generatedAbilities","latent_variables","ability_update","generated_abilities","_ctx","_cache","selecting","id","onClick","$event","style","color","$","createApp","app","mount"],"sourceRoot":""}